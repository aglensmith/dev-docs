{"path":"api-docs/customers/current-customer-api","templateID":0,"sharedPropsHashes":{"nav":"ZHaw9F","sidebarTree":"Z427i9","namespace":"Zd6xn0"},"localProps":{"version":"1.3","crumbs":[{"content":"API Docs","to":"/api-docs"},{"content":"Customers & Subscribers","to":"/api-docs/customers"},{"content":"Current Customer API","to":"/api-docs/customers/current-customer-api"}],"page":{"meta":{"title":"Current Customer API - Customers & Subscribers - API Docs","url":"/api-docs/customers/current-customer-api","description":"Current Customer API\n\n\n\nOn This Page\n\nIdentifying Logged-In Customers Securely\n\nExample JavaScript\n\n\n\nIdentifying Logged-In Customers Securely\n\nIf your ..."},"title":"Current Customer API","parsedPath":["pages","/api-docs","data","children",4,"data","children",2],"rootPagePath":"/api-docs","path":"/api-docs/customers/current-customer-api","isSubpage":true,"route":{"path":"/current-customer-api"},"data":{"blocks":[{"type":"text","data":"#  Current Customer API \r\n<div class=\"otp\" id=\"no-index\">\r\n\r\n### On This Page\r\n- [Identifying Logged-In Customers Securely](#identifying-logged-in-customers-securely)\r\n- [Example JavaScript](#example-javascript)\r\n\r\n</div> \r\n\r\n## Identifying Logged-In Customers Securely\r\n\r\nIf your application interacts dynamically with the BigCommerce storefront, and conveys information that is specific to a particular logged-in customer, you must confirm that customer’s identity within the insecure environment of the user’s browser.\r\n\r\nTo address this need, BigCommerce provides a Current Customer endpoint, which your app can access via JavaScript on the storefront. This endpoint returns a JWT with identifying details about the customer. The information is signed with your [OAuth client secret](/api-docs/getting-started/basics/authentication#authentication_client-id-secret).\r\n\r\n## Example JavaScript\r\n\r\nBelow is example JavaScript that will access this JWT. To test the JWT functionality, you can install this JavaScript on your sandbox BigCommerce store. Your application’s Client ID must be included in the request (to identify the requesting application):\r\n\r\n<!--\r\ntitle: \"Identify Logged In Customers\"\r\nsubtitle: \"\"\r\nlineNumbers: true\r\n-->\r\n\r\n```html\r\n<script type=\"text/javascript\">\r\nfunction customerJWT() {  \r\n    var appClientId = \"**BC_CLIENT_ID**\"; // TODO: Fill this in with your app's client ID\r\n    var xmlhttp = new XMLHttpRequest();\r\n    xmlhttp.onreadystatechange = function() {\r\n        if (xmlhttp.readyState == 4 ) {\r\n           if (xmlhttp.status == 200) {\r\n               alert('Customer JWT:\\n' + xmlhttp.responseText);\r\n           }\r\n           else if (xmlhttp.status == 404) {\r\n              alert('Not logged in!');\r\n           }\r\n           else {\r\n               alert('Something went wrong');\r\n           }\r\n        }\r\n    };\r\n    xmlhttp.open(\"GET\", \"/customer/current.jwt?app_client_id=\"+appClientId, true);\r\n    xmlhttp.send();\r\n}\r\ncustomerJWT();\r\n</script>\r\n\r\n```\r\n\r\nIf you are logged into the storefront with a customer account, the above JavaScript should alert to the browser with a JWT token. If no customer is logged in, BigCommerce will return a 404 response, and you will see an error message. The JWT returned from this endpoint (example below) can be decoded on JWT.IO\r\n\r\n**Example Logged In Customers Response**\r\n\r\n```json\r\n{\r\n  \"customer\": {\r\n    \"id\": 4927,\r\n    \"email\": \"john.doe@gmail.com\",\r\n    \"group_id\": \"6\"\r\n  },\r\n  \"iss\": \"bc/apps\",\r\n  \"sub\": \"abc123\",\r\n  \"iat\": 1480831863,\r\n  \"exp\": 1480832763,\r\n  \"version\": 1,\r\n  \"aud\": \"6sv16tfx3j5gsopm42ss5dd67g2srvq\",\r\n  \"application_id\": \"6sv16tasdgr2b5hs5dd67g2srvq\",\r\n  \"store_hash\": \"abc123\",\r\n  \"operation\": \"current_customer\"\r\n}\r\n```\r\n\r\nBy design, your application should send this token to the application’s server, validate it against your client secret, and then use it as a trusted indication of the logged-in customer’s identity, before displaying confidential information to them. \r\n\r\nAn end-to-end example, which displays a customer’s recently purchased products, is available in our [Ruby](https://github.com/bigcommerce/hello-world-app-ruby-sinatra/) and [PHP](https://github.com/bigcommerce/hello-world-app-php-silex/) sample apps.\r\n"}],"children":[]}}}}
